<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Batalla Pokémon</title>
  <style>
    #pokemonContainer {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
    }
    .pokemon {
      text-align: center;
    }
    img {
      max-width: 100%;
      height: auto;
    }
    #battleResult {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>EL CLUB DE LA PELEA POKEMON</h1>

  <div id="pokemonContainer">
    <div class="pokemon" id="userPokemon">
      <h2>Name: <span id="userPokemonName"></span></h2>
      <p>Hp: <span id="userPokemonHp"></span></p>
      <p>Attack: <span id="userPokemonAttack"></span></p>
      <p>Defense: <span id="userPokemonDefense"></span></p>
      <p>Speed: <span id="userPokemonSpeed"></span></p>
      <button onclick="choosePokemon()">Mi Pokémon</button>
    </div>

    <div class="pokemon" id="cpuPokemon">
      <h2>Name: <span id="cpuPokemonName"></span></h2>
      <p>Hp: <span id="cpuPokemonHp"></span></p>
      <p>Attack: <span id="cpuPokemonAttack"></span></p>
      <p>Defense: <span id="cpuPokemonDefense"></span></p>
      <p>Speed: <span id="cpuPokemonSpeed"></span></p>
      <button onclick="fight()">Fight</button>
    </div>
  </div>

  <div id="battleResult"></div>

  <script>
    let userPokemon;
    let cpuPokemon;

    async function choosePokemon() {
      const randomPokemonId = Math.floor(Math.random() * 806) + 1;
      const pokemonData = await getPokemonData(randomPokemonId);
      userPokemon = {
        ...pokemonData,
        hp: calculateHp(pokemonData.base_experience),
      };

      displayPokemon(userPokemon, 'user');
    }

    async function fight() {
      if (!userPokemon) {
        alert('Debes escoger un Pokémon primero.');
        return;
      }

      const randomPokemonId = Math.floor(Math.random() * 806) + 1;
      const pokemonData = await getPokemonData(randomPokemonId);
      cpuPokemon = {
        ...pokemonData,
        hp: calculateHp(pokemonData.base_experience),
      };

      displayPokemon(cpuPokemon, 'cpu');

      setTimeout(() => {
        battle();
      }, 5000);
    }

    function battle() {
      let userTurn = userPokemon.speed > cpuPokemon.speed;
      while (userPokemon.hp > 0 && cpuPokemon.hp > 0) {
        const turns = Math.abs(userPokemon.speed - cpuPokemon.speed) + 1;

        for (let i = 0; i < turns; i++) {
          if (userTurn) {
            userAttack();
          } else {
            cpuAttack();
          }
        }

        userTurn = !userTurn;
      }

      displayBattleResult();
    }

    function userAttack() {
      const damage = calculateDamage(userPokemon, cpuPokemon);
      cpuPokemon.hp -= damage;
    }

    function cpuAttack() {
      const damage = calculateDamage(cpuPokemon, userPokemon);
      userPokemon.hp -= damage;
    }

    function displayPokemon(pokemon, player) {
      const pokemonContainer = document.getElementById(`${player}Pokemon`);
      pokemonContainer.innerHTML = `
        <h2>Name: ${pokemon.name}</h2>
        <p>Hp: ${pokemon.hp}</p>
        <p>Attack: ${pokemon.stats[1].base_stat}</p>
        <p>Defense: ${pokemon.stats[2].base_stat}</p>
        <p>Speed: ${pokemon.stats[5].base_stat}</p>
        <img src="${pokemon.sprites.other['official-artwork'].front_default}" alt="${pokemon.name}">
      `;
    }

    function displayBattleResult() {
      const battleResult = document.getElementById('battleResult');
      if (userPokemon.hp > 0) {
        battleResult.textContent = `¡GANADOR! ¡${userPokemon.name} ha ganado con ${userPokemon.hp} HP!`;
      } else if (cpuPokemon.hp > 0) {
        battleResult.textContent = `¡GANADOR! ¡${cpuPokemon.name} ha ganado con ${cpuPokemon.hp} HP!`;
      } else {
        battleResult.textContent = 'La batalla ha terminado en empate.';
      }
    }

    async function getPokemonData(pokemonId) {
      const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonId}`);
      const data = await response.json();
      return data;
    }

    function calculateHp(baseExperience) {
      return Math.floor((baseExperience ** 2) * (1 + baseExperience / 100));
    }

    function calculateDamage(attacker, defender) {
      return Math.floor(
        (attacker.stats[1].base_stat - defender.stats[2].base_stat) *
        (1 + attacker.stats[5].base_stat / 100)
      );
    }
  </script>
</body>
</html>
